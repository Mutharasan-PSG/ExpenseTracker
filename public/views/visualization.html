<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Visualization</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
  <!-- Sidebar -->
  <aside class="fixed top-0 left-0 h-full bg-gray-900 w-64 text-white">
    <div class="flex items-center justify-center h-20 border-b border-gray-700">
      <span class="text-2xl font-semibold">Expense Tracker</span>
    </div>
    <nav class="mt-4">
      <a href="dashboard.html" class="block py-3 px-6 hover:bg-gray-700 transition">Dashboard</a>
      <a href="visualization.html" class="block py-3 px-6 hover:bg-gray-700 transition">Income & Expense Visualization</a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="ml-64 min-h-screen p-6 bg-gray-100">
    <!-- Header -->
    <header class="flex justify-between items-center bg-white p-6 shadow rounded-lg">
      <h1 class="text-xl font-semibold">Income & Expense Visualization</h1>
    </header>

    <!-- Data Selector -->
    <section class="mt-8 bg-white p-6 rounded-lg shadow">
      <div class="flex items-center justify-between">
        <label for="dataType" class="text-gray-700">Select Data Type</label>
        <select id="dataType" class="border-gray-300 rounded-md p-2">
          <option value="both">Both Income & Expense</option>
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>

        <label for="chartType" class="ml-6 text-gray-700">Select Chart Type</label>
        <select id="chartType" class="border-gray-300 rounded-md p-2">
          <option value="bar">Bar Chart</option>
          <option value="pie">Pie Chart</option>
          <option value="line">Line Chart</option>
        </select>

        <label for="dateRange" class="ml-6 text-gray-700">Select Date Range</label>
        <label for="startDate" class="block text-sm font-medium text-gray-700">Start Date</label>
        <input type="date" id="startDate" name="startDate" class="border-gray-300 rounded-md p-2" placeholder="Select start date" title="Select the start date of the event">
        
        <label for="endDate" class="block text-sm font-medium text-gray-700">End Date</label>
        <input type="date" id="endDate" name="endDate" class="border-gray-300 rounded-md p-2 ml-2" placeholder="Select end date" title="Select the end date of the event">
        
        <button onclick="loadChartData()" class="bg-blue-500 text-white px-4 py-2 rounded-md">Visualize</button>
      </div>
    </section>

    <!-- Chart Container -->
    <section class="mt-10 bg-white p-6 rounded-lg shadow">
      <canvas id="incomeExpenseChart"></canvas>
    </section>
  </main>

  <script>
    const ctx = document.getElementById('incomeExpenseChart').getContext('2d');
    let chartInstance;
  
    // Unique colors for each category
    const categoryColors = {
      // Income categories
      'Salary': '#FF6384',       // Pinkish Red
      'Freelance': '#36A2EB',    // Soft Blue
      'Gift': '#FFCE56',         // Soft Yellow
      'Investment': '#4BC0C0',   // Light Teal
      'Other Income': '#9966FF', // Soft Purple
  
      // Expense categories
      'Food': '#FF9F40',         // Orange
      'Transport': '#C22E32',    // Dark Red
      'Utilities': '#2E7D32',    // Forest Green
      'Entertainment': '#1E88E5', // Deep Blue
      'Medical': '#6A1B9A',      // Deep Purple
      'Shopping': '#F9A825',     // Amber
      'Bills': '#D84315',        // Burnt Orange
      'Other Expense': '#546E7A' // Slate Gray
    };
  
    // Fetch and visualize the data based on selected options
    const loadChartData = () => {
      const dataType = document.getElementById('dataType').value;
      const chartType = document.getElementById('chartType').value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
  
      // Fetch data from the API
      fetch(`/api/visualizeData?dataType=${dataType}&startDate=${startDate}&endDate=${endDate}`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to fetch data from the server');
          }
          return response.json();
        })
        .then(data => {
          const labels = data.categories || [];
          const chartData = data.data || [];
  
          // Destroy the previous chart if it exists
          if (chartInstance) {
            chartInstance.destroy();
          }
  
          // Create a new chart
          chartInstance = new Chart(ctx, {
            type: chartType, // Dynamic chart type (bar, pie, etc.)
            data: {
              labels: labels, // Categories as labels
              datasets: [{
                label: 'Amount',
                data: chartData, // Total amounts for each category
                backgroundColor: labels.map(label => categoryColors[label] || '#808080'), // Assign unique colors
                borderColor: labels.map(label => categoryColors[label] || '#333333'), // Slightly darker fallback border
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              plugins: {
                tooltip: {
                  callbacks: {
                    label: function (tooltipItem) {
                      // Show the category name and its total amount
                      const label = tooltipItem.label || 'Unknown';
                      const amount = tooltipItem.raw || 0;
                      return `${label}: â‚¹${amount}`;
                    }
                  }
                },
                legend: {
                  position: 'top',
                  labels: {
                    usePointStyle: true // Use point style for legend
                  }
                }
              }
            }
          });
        })
        .catch(error => {
          console.error('Error fetching data:', error);
        });
    };
  </script>
  
  
</body>
</html>

